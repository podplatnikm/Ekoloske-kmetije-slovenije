<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <style>
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
            height: 100%;
        }
        /* Optional: Makes the sample page fill the window. */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</h:head>

<h:body>

    <f:view>
        <f:event type="preRenderView" listener="#{uporabnikBean.pridobiZaMapo}" />
    </f:view>

    <div id="map"></div>
    <script>


        //Pridobitev naslovov in nazivov ter pretvorba v polje
        var nasloviBean="#{uporabnikBean.naslovi}";
        var naziviBean="#{uporabnikBean.nazivi}";
        var idjiBean="#{uporabnikBean.idji}";
        var naslovi = nasloviBean.split(",");
        var nazivi = naziviBean.split(",");
        var idji = idjiBean.split(",");
        naslovi[0]=naslovi[0].replace('[', '');
        naslovi[naslovi.length-1]=naslovi[naslovi.length-1].replace(']', '');
        nazivi[0]=nazivi[0].replace('[', '');
        nazivi[nazivi.length-1]=nazivi[nazivi.length-1].replace(']', '');
        idji[0]=idji[0].replace('[', '');
        idji[idji.length-1]=idji[idji.length-1].replace(']', '');


        var map, infoWindow;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: -34.397, lng: 150.644},
                zoom: 18


            });

            infoWindow = new google.maps.InfoWindow;
            var geocoder = new google.maps.Geocoder();
            window.onload = geocodeAddress(geocoder, map);

            // Try HTML5 geolocation.
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    infoWindow.setPosition(pos);
                    infoWindow.setContent('Vaša lokacija');
                    infoWindow.open(map);
                    map.setCenter(pos);
                }, function() {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }
        }
        function geocodeAddress(geocoder, resultsMap) {

                geocoder.geocode({'address': naslovi[0]}, function(results, status) {
                    if (status === 'OK') {
                        var marker = new google.maps.Marker({
                            map: resultsMap,
                            position: results[0].geometry.location,
                            url: 'https://id.id?id='+idji[0],
                            label: {
                                text: nazivi[0],
                                color: "#000000",
                                fontSize: "20px",
                                fontWeight: "bold"
                            }
                        });
                        google.maps.event.addListener(marker, 'click', function() {
                            window.location.href = marker.url;
                        });
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });

                geocoder.geocode({'address': naslovi[1]}, function(results, status) {
                    if (status === 'OK') {
                        var marker = new google.maps.Marker({
                            map: resultsMap,
                            position: results[0].geometry.location,
                            url: 'https://id.id?id='+idji[1],
                            label: {
                                text: nazivi[1],
                                color: "#000000",
                                fontSize: "20px",
                                fontWeight: "bold"
                            }
                        });
                        google.maps.event.addListener(marker, 'click', function() {
                            window.location.href = marker.url;
                        });
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });

                geocoder.geocode({'address': naslovi[2]}, function(results, status) {
                    if (status === 'OK') {
                        var marker = new google.maps.Marker({
                            map: resultsMap,
                            position: results[0].geometry.location,
                            url: 'https://id.id?id='+idji[2],
                            label: {
                                text: nazivi[2],
                                color: "#000000",
                                fontSize: "20px",
                                fontWeight: "bold"
                            }
                        });
                        google.maps.event.addListener(marker, 'click', function() {
                            window.location.href = marker.url;
                        });
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });

                geocoder.geocode({'address': naslovi[3]}, function(results, status) {
                    if (status === 'OK') {
                        var marker = new google.maps.Marker({
                            map: resultsMap,
                            position: results[0].geometry.location,
                            url: 'https://id.id?id='+idji[3],
                            label: {
                                text: nazivi[3],
                                color: "#000000",
                                fontSize: "20px",
                                fontWeight: "bold"
                            }
                        });
                        google.maps.event.addListener(marker, 'click', function() {
                            window.location.href = marker.url;
                        });
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });

                geocoder.geocode({'address': naslovi[4]}, function(results, status) {
                    if (status === 'OK') {
                        var marker = new google.maps.Marker({
                            map: resultsMap,
                            position: results[0].geometry.location,
                            url: 'https://id.id?id='+idji[4],
                            label: {
                                text: nazivi[4],
                                color: "#000000",
                                fontSize: "20px",
                                fontWeight: "bold"
                            }
                        });
                        google.maps.event.addListener(marker, 'click', function() {
                            window.location.href = marker.url;
                        });
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });

                geocoder.geocode({'address': naslovi[5]}, function(results, status) {
                    if (status === 'OK') {
                        var marker = new google.maps.Marker({
                            map: resultsMap,
                            position: results[0].geometry.location,
                            url: 'https://id.id?id='+idji[5],
                            label: {
                                text: nazivi[5],
                                color: "#000000",
                                fontSize: "20px",
                                fontWeight: "bold"
                            }
                        });
                        google.maps.event.addListener(marker, 'click', function() {
                            window.location.href = marker.url;
                        });
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });

                geocoder.geocode({'address': naslovi[6]}, function(results, status) {
                    if (status === 'OK') {
                        var marker = new google.maps.Marker({
                            map: resultsMap,
                            position: results[0].geometry.location,
                            url: 'https://id.id?id='+idji[6],
                            label: {
                                text: nazivi[6],
                                color: "#000000",
                                fontSize: "20px",
                                fontWeight: "bold"
                            }
                        });
                        google.maps.event.addListener(marker, 'click', function() {
                            window.location.href = marker.url;
                        });
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });

                geocoder.geocode({'address': naslovi[7]}, function(results, status) {
                    if (status === 'OK') {
                        var marker = new google.maps.Marker({
                            map: resultsMap,
                            position: results[0].geometry.location,
                            url: 'https://id.id?id='+idji[7],
                            label: {
                                text: nazivi[7],
                                color: "#000000",
                                fontSize: "20px",
                                fontWeight: "bold"
                            }
                        });
                        google.maps.event.addListener(marker, 'click', function() {
                            window.location.href = marker.url;
                        });
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });

                geocoder.geocode({'address': naslovi[8]}, function(results, status) {
                    if (status === 'OK') {
                        var marker = new google.maps.Marker({
                            map: resultsMap,
                            position: results[0].geometry.location,
                            url: 'https://id.id?id='+idji[8],
                            label: {
                                text: nazivi[8],
                                color: "#000000",
                                fontSize: "20px",
                                fontWeight: "bold"
                            }
                        });
                        google.maps.event.addListener(marker, 'click', function() {
                            window.location.href = marker.url;
                        });
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });

                geocoder.geocode({'address': naslovi[9]}, function(results, status) {
                    if (status === 'OK') {
                        var marker = new google.maps.Marker({
                            map: resultsMap,
                            position: results[0].geometry.location,
                            url: 'https://id.id?id='+idji[9],
                            label: {
                                text: nazivi[9],
                                color: "#000000",
                                fontSize: "20px",
                                fontWeight: "bold"
                            }
                        });
                        google.maps.event.addListener(marker, 'click', function() {
                            window.location.href = marker.url;
                        });
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });

                geocoder.geocode({'address': naslovi[10]}, function(results, status) {
                    if (status === 'OK') {
                        var marker = new google.maps.Marker({
                            map: resultsMap,
                            position: results[0].geometry.location,
                            url: 'https://id.id?id='+idji[10],
                            label: {
                                text: nazivi[10],
                                color: "#000000",
                                fontSize: "20px",
                                fontWeight: "bold"
                            }
                        });
                        google.maps.event.addListener(marker, 'click', function() {
                            window.location.href = marker.url;
                        });
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });
        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
                'Napaka: Prišlo je do napake pri iskanju lokacije' :
                'Napaka: Imate onemogočeno lokacijo.');
            infoWindow.open(map);
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyByLr-aHHpzagMEby3tumeCcWetol67XnI&amp;callback=initMap" async="" defer=""></script>


</h:body>
</html>
